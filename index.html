<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Radius 5 — Almaty</title>

  <!-- Mapbox GL -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.16.1/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.16.1/mapbox-gl.js"></script>

  <!-- Turf.js для геодезического круга -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <style>
    html,body,#map{margin:0;height:100%;width:100%;background:#000;overflow:hidden}
    .mapboxgl-ctrl-scale{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Твой публичный токен
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2lrYWZhbmthOTEiLCJhIjoiY21nczN5anlwMWh6bjJrcXdjYW02MjV0eiJ9.XT3r4HFDoQDKdl_IPqm6gA';

    // Центр Алматы [lng, lat]
    const center = [76.8897, 43.2389];

    // Стиль карты: можешь переключить на свой кастомный
    const styleUrl = 'mapbox://styles/sikafanka91/cmgs3sw6a001l01r70vif0yx9';
    // fallback на стандартный дарк (если вдруг твой стиль приватный):
    // const styleUrl = 'mapbox://styles/mapbox/dark-v11';

    const map = new mapboxgl.Map({
      container: 'map',
      style: styleUrl,
      center: center,
      zoom: 12,
      attributionControl: false
    });

    map.addControl(new mapboxgl.NavigationControl({showCompass:false}));
    map.addControl(new mapboxgl.ScaleControl({maxWidth:120, unit:'metric'}));

    map.on('load', () => {
      // Геодезический круг 5 км
      const circle = turf.circle(center, 5, {units:'kilometers', steps:128});

      map.addSource('r5', { type:'geojson', data: circle });

      // 1) Мягкая подсветка (glow) — большой blur и малая прозрачность
      map.addLayer({
        id: 'r5-glow',
        type: 'line',
        source: 'r5',
        paint: {
          'line-color': '#7C3AED',     // фиолет
          'line-width': 18,
          'line-blur': 16,
          'line-opacity': 0.35
        }
      });

      // 2) Заливка круга
      map.addLayer({
        id: 'r5-fill',
        type: 'fill',
        source: 'r5',
        paint: {
          'fill-color': '#7C3AED',
          'fill-opacity': 0.16
        }
      });

      // 3) Контур круга (неон с небольшим blur)
      map.addLayer({
        id: 'r5-stroke',
        type: 'line',
        source: 'r5',
        paint: {
          'line-color': '#60A5FA',    // неоново-синий
          'line-width': 3,
          'line-blur': 1.1,
          'line-opacity': 0.95
        }
      });

      // 4) Точка центра
      map.addSource('r5-center', {
        type:'geojson',
        data:{ type:'Feature', geometry:{ type:'Point', coordinates:center } }
      });
      map.addLayer({
        id:'r5-center-dot',
        type:'circle',
        source:'r5-center',
        paint:{
          'circle-radius':5,
          'circle-color':'#38BDF8',
          'circle-stroke-width':2,
          'circle-stroke-color':'#0B0F16'
        }
      });

      // Камера на круг
      const bbox = turf.bbox(circle);
      map.fitBounds(bbox, { padding: 40, duration: 700 });

      // 5) Анимация «пульса» — лёгкое дыхание заливки и свечения
      let t0 = performance.now();
      function animate() {
        const t = (performance.now() - t0) / 1000; // сек
        // от 0 до 1 по синусоиде
        const pulse = (Math.sin(t * 2.2) + 1) / 2;

        // fill: 0.12..0.22
        const fillOpacity = 0.12 + pulse * 0.10;
        map.setPaintProperty('r5-fill', 'fill-opacity', fillOpacity);

        // glow: ширина 14..22, прозрачность 0.25..0.45
        const glowWidth = 14 + pulse * 8;
        const glowOpacity = 0.25 + pulse * 0.20;
        map.setPaintProperty('r5-glow', 'line-width', glowWidth);
        map.setPaintProperty('r5-glow', 'line-opacity', glowOpacity);

        requestAnimationFrame(animate);
      }
      animate();
    });
  </script>
</body>
</html>
